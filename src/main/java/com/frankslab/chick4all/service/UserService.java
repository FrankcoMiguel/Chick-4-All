package com.frankslab.chick4all.service;\n\nimport com.frankslab.chick4all.model.User;\nimport com.frankslab.chick4all.repository.UserRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\nimport java.util.Optional;\n\n@Service\npublic class UserService {\n\n    @Autowired\n    private UserRepository userRepository;\n\n    @Autowired\n    private PasswordEncoder passwordEncoder;\n\n    public List<User> findAll() {\n        return userRepository.findAll();\n    }\n\n    public Optional<User> findById(String id) {\n        return userRepository.findById(id);\n    }\n\n    public Optional<User> findByUsername(String username) {\n        return userRepository.findByUsername(username);\n    }\n\n    public Optional<User> findByPhone(String phone) {\n        return userRepository.findByPhone(phone);\n    }\n\n    public User save(User user) {\n        // Encode password before saving\n        user.setPassword(passwordEncoder.encode(user.getPassword()));\n        return userRepository.save(user);\n    }\n\n    public User update(String id, User user) {\n        return userRepository.findById(id)\n                .map(existingUser -> {\n                    existingUser.setPhone(user.getPhone());\n                    existingUser.setUsername(user.getUsername());\n                    if (user.getPassword() != null && !user.getPassword().isEmpty()) {\n                        existingUser.setPassword(passwordEncoder.encode(user.getPassword()));\n                    }\n                    return userRepository.save(existingUser);\n                })\n                .orElseThrow(() -> new RuntimeException(\"User not found with id: \" + id));\n    }\n\n    public void delete(String id) {\n        userRepository.deleteById(id);\n    }\n\n    public boolean existsByUsername(String username) {\n        return userRepository.existsByUsername(username);\n    }\n\n    public boolean existsByPhone(String phone) {\n        return userRepository.existsByPhone(phone);\n    }\n\n    public boolean validatePassword(String rawPassword, String encodedPassword) {\n        return passwordEncoder.matches(rawPassword, encodedPassword);\n    }\n}